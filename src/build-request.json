{
  "kind": "build_request",
  "title": "Fix manual input balance update and input validation",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix backend recordBitcoinPurchase method to immediately update user balance when manual Bitcoin purchase inputs are submitted, ensuring the balance reflects the new credit instantly without delay",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Manual inputs aren't instantly reflecting on balance"
        ]
      },
      "acceptanceCriteria": [
        "User balance increases immediately after successful recordBitcoinPurchase call",
        "Balance change is visible in dashboard and balance displays without page refresh",
        "React Query cache invalidation triggers automatic UI updates"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement backend validation for manual Bitcoin purchase inputs to reject invalid transaction IDs (non-64-character hex strings) and invalid BTC amounts (negative, zero, or exceeding 8 decimal places)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "App accepts all manual inputs"
        ]
      },
      "acceptanceCriteria": [
        "Backend rejects transaction IDs that are not exactly 64 hexadecimal characters",
        "Backend rejects BTC amounts that are zero, negative, or have more than 8 decimal places",
        "Validation errors return descriptive error messages to the frontend",
        "Only valid inputs result in balance updates and purchase records"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update frontend ManualVerificationForm and InstantFundingForm to display backend validation errors clearly to users when invalid inputs are submitted",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Backend validation errors are displayed in the form UI with clear error messages",
        "Form prevents submission during validation or processing",
        "Success feedback is shown only after backend confirms the purchase was recorded"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor backend architecture in backend/main.mo",
    "Preserve existing frontend validation logic while adding backend error display",
    "Do not modify immutable frontend paths (useInternetIdentity, useActor, main.tsx, ui components)"
  ],
  "nonGoals": [
    "Changing the manual verification workflow or UI design",
    "Adding duplicate transaction detection",
    "Implementing automated blockchain verification",
    "Modifying withdrawal or peer transfer functionality"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}